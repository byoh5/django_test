{% load static %}
{% include "common/head.html" %}
<link rel="stylesheet" type="text/css" href="{% static 'resource/css/login.css' %}" />
<div class="wrap login">
    <div class="loginBox">
        <h1>
            <a href="/"><img src="{% static 'resource/img/common/logo_login.png' %}" alt="런코딩"></a>
        </h1>
        <form id="login_form">
            <div class="input_area">
                {% csrf_token %}
                <input type="text" name="login_id" id="login_id" class="login_inp" placeholder="이메일을 입력해주세요." />
                <input type="password" name="login_pass" id="login_pass" class="login_inp" placeholder="비밀번호를 입력해주세요." />
            </div>
        </form>
        <div class="btn_area">
            <a href="javascript:void(0);" onClick="javascript:login_submit();" class="btn login">로그인</a>
            <a href="/regi/" class="link join">회원가입</a>
            <a href="#modal01" class="link find">비밀번호 재설정</a>
        </div>

<!--        <div class="snsLogin">-->
<!--            <span>SNS계정 간편 로그인</span>-->
<!--            <a href="#"><img src="{% static 'resource/img/common/ico_naver.png' %}" alt="네이버 계정으로 로그인"></a>-->
<!--            <a href="#"><img src="{% static 'resource/img/common/ico_google.png' %}" alt="구글 계정으로 로그인"></a>-->
<!--            <a href="#"><img src="{% static 'resource/img/common/ico_facebook.png' %}" alt="페이스북 계정으로 로그인"></a>-->
<!--        </div>-->
    </div>
    <!-- find password modal -->
    <div data-ml-modal="" id="modal01">
        <a href="#" class="modal-overlay"></a>
        <div class="modal-dialog modal-dialog-lg findPW">
            <a href="#" class="modal-close">×</a>
            <h3>비밀번호 재설정</h3>
            <div class="modal-content">
                <span>회원님의 이메일로 <strong>임시 비밀번호</strong>를 보내드립니다.</span>
                <div class="input_area">
                    <form id="find_form">
                    {% csrf_token %}
                    <input type="text" name="find_loginId" id="find_loginId" class="login_inp" placeholder="이메일을 입력해주세요.">
                    </form>
                </div>
                <div class="btn_area">
                    <a href="javascript:void(0);" onclick="javascript:findPass();" class="btn login">메일로 보내기</a>
                </div>
            </div>
        </div>
    </div>
</div>

<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/stove99/jquery-modal-sample@v1.4/css/animate.min.css" />
<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/stove99/jquery-modal-sample@v1.4/css/jquery.modal.css" />
<script src="//cdn.jsdelivr.net/gh/stove99/jquery-modal-sample@v1.4/js/jquery.modal.js"></script>
<script src="//cdn.jsdelivr.net/gh/stove99/jquery-modal-sample@v1.4/js/modal.js"></script>

<script>

    function login_submit()
    {
        var email_patten = /^[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*.[a-zA-Z]{2,3}$/i;  // 이메일이 적합한지 검사할 정규식
        var email = document.getElementById('login_id');
        var pass = document.getElementById('login_pass');

        if(email.value == "")
        {
            $("#res_msg").text("이메일 아이디를 입력해 주세요.");
            $('div.modal').modal();
            return false;
        }
        else if(!email_patten.test(email.value))
        {
            $("#res_msg").text("이메일 주소 형식을 맞춰주세요. (ex.runcoding@***.com)");
            $('div.modal').modal();
            return false;
        }
        else if(pass.value == "")
        {
            $("#res_msg").text("비밀번호를 입력해 주세요.");
            $('div.modal').modal();
            return false;
        }
        else
        {
            var login_frm = $('#login_form');

             $.ajax({
                    data: login_frm.serialize(),
                    type: 'post',
                    url: '/login_form/',
                    dataType: 'json',
                    success:function(result)
                    {
                        if(result == 200)
                        {
                             location.href="/";
                             return true;
                        }
                        else if(result == 202)
                        {
                            $("#res_msg").text("회원 정보를 다시 확인해주세요.");
                        }
                        else if(result == 204)
                        {
                            $("#res_msg").text("가입자가 아닙니다. 회원가입을 해주세요.");
                            email.value = "";
                            pass.value = "";
                        }
                       $('div.modal').modal();
                    }
             });
        }
    }

    function findPass()
	{
	    var email_patten = /^[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*.[a-zA-Z]{2,3}$/i;  // 이메일이 적합한지 검사할 정규식
	    var login_id = $('[name=find_loginId]').val();
	    if(login_id == "")
	    {
             alert("이메일 주소를 입력해 주세요.");
             return false;
	    }
	    else if(!email_patten.test(login_id))
        {
            alert("이메일 주소 형식을 맞춰주세요. (ex.runcoding@***.com)");
            return false;
        }
	    else
	    {
            var find_frm = $('#find_form');

             $.ajax({
                    data: find_frm.serialize(),
                    type: 'post',
                    url: '/find_pass/',
                    dataType: 'json',
                    success:function(result)
                    {
                        if(result == 200)
                        {
                             alert("입력하신 이메일 주소로 전달되었습니다.");
                             location.href="/run_login/";
                             return true;
                        }
                        else if(result == 204)
                        {
                            $("#res_msg").text("가입자가 아닙니다. 회원가입을 해주세요.");
                        }
                        else
                        {
                            $("#res_msg").text("회원 정보를 다시 확인해주세요.");
                        }
                       $('div.modal').modal();
                    }
             });
        }
	}
</script>


</body></html>